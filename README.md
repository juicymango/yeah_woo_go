# YeahWooGo Automatic Variable Lifecycle Analysis Tool

YeahWooGo is a tool designed to simplify server-side development in the Go programming language. Our goal is to create an efficient development experience that makes users exclaim "Yeah!", "Woo!", and "Go!" while using it.

## Background

In today's fast-paced software development environment, developers often face the challenge of quickly understanding and analyzing complex codebases. Whether it's taking over legacy projects, collaborative development, or code review, efficiently grasping code structure and logic is crucial. To address this, we proudly introduce YeahWooGoâ€”a revolutionary code note-taking and analysis tool aimed at significantly improving developers' code comprehension efficiency and collaboration capabilities.

### Key Scenarios YeahWooGo Addresses:

1. Quickly familiarizing with unfamiliar codebases: When facing a new project or needing to maintain legacy code, YeahWooGo helps developers rapidly capture the core logic and structure of the code.

2. Efficient code review and knowledge transfer: In team collaboration, the simplified code and visualized call graphs generated by YeahWooGo greatly accelerate the code review process, making knowledge sharing more intuitive and efficient.

3. Complex code refactoring assistance: Through intelligent simplification and focus point analysis, YeahWooGo provides developers with a clear perspective to understand and refactor complex code segments.

### Unique Advantages of YeahWooGo:

1. Smart code simplification: YeahWooGo is not just a static code analysis tool. It can dynamically generate simplified code views based on user-specified focus points (such as specific variables or functions). This "local simplicity" display method allows developers to focus on the most relevant code snippets, greatly reducing cognitive load.

2. Interactive exploration: Thanks to its second-level response speed, YeahWooGo supports fast, iterative code exploration by developers. Users can easily adjust focus points and view different levels of code abstraction in real-time, greatly improving the efficiency of code understanding.

3. Visualization of call relationships: By automatically generating function call graphs, YeahWooGo provides developers with a macro perspective, helping to understand the position and role of functions in the entire project. This is particularly important for understanding the architecture of large projects.

4. Seamless integration with modern development processes: YeahWooGo generates results based on local code, ensuring compatibility with version control systems. When code is updated, simply regenerating the analysis ensures the timeliness of code notes.

5. Enhanced team collaboration: Code notes generated by YeahWooGo can be easily shared with team members, providing a powerful tool for code review, knowledge transfer, and new member onboarding.

6. AI-assisted analysis: Results generated by YeahWooGo can be used as context input for large language models, further enhancing code analysis capabilities and paving the way for intelligent refactoring and bug detection.

YeahWooGo is not just a code analysis tool; it represents a new paradigm for code understanding and documentation. By transforming complex codebases into easily understandable and shareable knowledge structures, YeahWooGo has the potential to significantly improve the productivity and code quality of development teams. Whether for experienced architects or junior developers just starting out, YeahWooGo can provide unique value, helping them understand code faster and more deeply, thus making more informed development decisions.

## How to Use the Tool

### Installation

Installation method:

Clone the code, use go build to compile, and generate the executable file yeah_woo_go.

```bash
git clone https://github.com/juicymango/yeah_woo_go.git
cd yeah_woo_go
go build
```

### Input and Output

Example of running command:

```bash
# Assuming there's a compiled executable file yeah_woo_go and an input JSON file input.json in the current directory.
./yeah_woo_go input.json 1> output.go 2> log.txt
```

#### 1. Input

The only input parameter for YeahWooGo is the path to a JSON format file. This file contains a task list, where each task corresponds to a function in the code. Each task item in the task list includes information such as the function file path, function name, variables of interest, etc. There's a detailed explanation below on how to fill out this JSON file.

#### 2. Output

After processing the input file, YeahWooGo generates the following outputs:

1. **Simplified Go code.** YeahWooGo will output a Go source code file to standard output. This file contains simplified functions corresponding to each task and its subtasks in the input task list.

2. **Updated JSON file.** YeahWooGo will update the original input JSON file, mainly including two aspects of updates:

    1. New subtasks: If subtasks of the input task are discovered during processing, these subtasks will be added to the updated JSON file.

    2. Call relationship tree: The updated JSON file will include a tree structure representing the call relationships between tasks. This structure describes the dependencies and call relationships between various tasks (functions).

3. **Run log.** YeahWooGo will output the run log to standard error.

#### 3. Introduction to Input JSON Format

The input file is overall a JSON file with the following Input structure.

```go
type Input struct {
    Method   string     `json:"method"`    // Currently only supports "GetRelevantFuncs"
    FuncTask FuncTask   `json:"func_task"` // Old version input, now used as runtime temporary variable, no need to fill
    Funcs    []FuncTask `json:"funcs"`     // Task list
}

type FuncTask struct {
    Key              string                 `json:"key"`                // Output: Unique identifier for the task
    Source           string                 `json:"source"`             // Path of the file where the function is located
    RecvTypes        string                 `json:"recv_types"`         // Receiver types of the method, multiple types separated by commas
    FuncName         string                 `json:"func_name"`          // Function name
    Comments         []string               `json:"comments"`           // Task comments
    VarNames         []string               `json:"var_names"`          // List of variables of interest, output function only includes related code
    FuncCalls        []string               `json:"func_calls"`         // List of function calls of interest, format: "`receiver type`|`package name`.`function name`"
    FuncCallerKeys   []string               `json:"func_caller_keys"`   // List of calling functions of interest, format: "`path`:`receiver type`|`function name`"
    ExtraImports     []string               `json:"extra_imports"`      // Additional packages that need to be imported, format: "`package name`|`include path`"
    CalleeTree       map[string]interface{} `json:"callee_tree"`        // Output: Downstream function call tree
    CallerTree       map[string]interface{} `json:"caller_tree"`        // Output: Upstream function caller tree
    ShowReturn       bool                   `json:"show_return"`        // Whether to show all return statements
    ShowBreak        bool                   `json:"show_break"`         // Whether to show all break statements
    ShowContinue     bool                   `json:"show_continue"`      // Whether to show all continue statements
    ExactMatch       bool                   `json:"exact_match"`        // Whether to use exact matching for variables of interest
    SubsequenceMatch bool                   `json:"subsequence_match"`  // Whether to use partial matching for variables of interest
    EnableCall       bool                   `json:"enable_call"`        // Experimental feature, keep false
    FarawayMatch     bool                   `json:"faraway_match"`      // Experimental feature, keep false
    OnlyRelevantFunc bool                   `json:"only_relevant_func"` // Experimental feature, keep false
    CollectComments  bool                   `json:"collect_comments"`   // Whether to collect and display task comments in the call tree and caller tree
    ShowAll          bool                   `json:"show_all"`           // Whether to show all code
}
```

##### Complex Parameter Explanation

###### List of Variables of Interest and Matching Rules: VarNames, ExactMatch, SubsequenceMatch

1. The role of VarNames:

VarNames is a list of target variable names used to specify the variables we are interested in within the code. The output function only includes code related to the variables of interest. This list can contain simple variable names, such as "user", or compound names, such as "user.Info.Name". The program will judge whether the variables in the code are related to our interest based on this list.

2. Three matching rules:

a) Default matching:

In default mode, the program compares the names in VarNames with the variable names in the code, checking if they have a prefix relationship. A successful match occurs when: a name in VarNames is a prefix of the code variable name, or the code variable name is a prefix of a name in VarNames. Specifically:

- If VarNames contains "user.Info", then "user", "user.Info", and "user.Info.Name" in the code will all match, because "user.Info" is their prefix, or they are prefixes of "user.Info".

- Similarly, if there's a variable "user.Info.Name" in the code, then "user", "user.Info", and "user.Info.Name" in VarNames will all be considered matches.

- However, "user.Name" won't match "user.Info", because neither is a prefix of the other.

The key reason for this design is: it ensures that any operation that might modify variables in VarNames will definitely be matched. This is because:

1. If the code uses a more specific sub-field (like "user.Info.Name"), it might modify the content of "user.Info", so it needs to be matched.

2. If the code uses a broader parent field (like "user"), modifications to it might affect "user.Info", so it also needs to be matched.

This matching strategy ensures that no potential relevant operations are missed, greatly improving the comprehensiveness and accuracy of code analysis. However, it may sometimes result in too many matches, so we provide the following two matching options.

b) ExactMatch is true (exact matching):

When exact matching is enabled, the program requires the variable names in the code to exactly match the names in VarNames, including the name's hierarchical structure. For example, only when a variable name appears in the code that is exactly the same as "user.Info" will it be considered a match. This strict matching method can avoid mismatches but may miss some related variables.

c) SubsequenceMatch is true (subsequence matching):

When subsequence matching is enabled, the program checks if the names in VarNames appear as a continuous subsequence in the variable names in the code, not requiring the positions to exactly correspond. For example, if VarNames contains "Info.Name", then "user.Info.Name.First" in the code will also be considered a match. This method provides maximum flexibility and can capture more potentially related variables, but it also increases the possibility of mismatches.

These three matching rules provide users with different levels of accuracy and flexibility. Their priority is subsequence matching > exact matching > default matching.

###### Subtask Generation: FuncCalls, FuncCallerKeys

`FuncCalls` and `FuncCallerKeys` are two important parameters used for analyzing function call relationships. They are used as follows:

1. FuncCalls (function calls):

    - Purpose: Explore downstream, analyzing other functions called by the current function. Create subtasks for each specified function call, delving into the content of the called functions.

    - Format: Each element is in the form of "`receiver type`|`package name`.`function name`", for example, "MyStruct|mypackage.MyFunction".

    - Actual operation: For each function call, the program will try to find the corresponding function definition in the code, then analyze the relevance of that function.

2. FuncCallerKeys (function callers):

    - Purpose: Explore upstream, analyzing which functions call the current function. Create subtasks for each specified caller, analyzing the context in which the current function is called.

    - Format: Each element is in the form of "`path`:`receiver type`|`function name`", for example, "/path/to/file.go:*MyStruct|MyFunction".

    - Actual operation: For each specified function, the program will try to find where this function is called and analyze the relevance of these call points.

The main difference between these two parameters is:

- `FuncCalls` focuses on what other functions are called inside the currently analyzed function.

- `FuncCallerKeys` focuses on which other functions call the currently analyzed function.

Using these two parameters, we can build a function call graph that includes both downstream functions called by the current function (via `FuncCalls`) and upstream functions that call the current function (via `FuncCallerKeys`). This analysis can help us understand the dependencies between functions, track data flow, and identify possible code paths.

In practical use, these two parameters are usually set based on the initial analysis needs, and then may be dynamically updated during the analysis process to explore more related function call relationships.

Important note:

To improve running efficiency, YeahWooGo does not parse go.mod files. Instead, it finds local files based on the paths in import statements. Therefore, when using YeahWooGo, there are the following requirements:

1. The paths in import statements must match the actual file paths in the local file system.

2. All related code repositories must have been cloned locally.

#### 4. Usage Process

YeahWooGo runs very fast, usually completing analysis in just a few seconds. This means users can conveniently obtain updated output results by continuously adjusting the content of the input JSON, achieving rapid interaction with the tool. Here's a suggested usage process that can help users explore and analyze code more effectively:

1. Start small: First, choose a specific function and a related variable as a starting point. This allows you to focus on a specific part of the code.

2. Gradually expand the scope: Once you have an understanding of the initial results, you can add more variable names to the VarNames list. This will make the tool display more code statements related to these variables, helping you gradually build an understanding of the overall logic of the function.

3. Explore relationships between functions: If you want to learn more about related functions, you can use FuncCalls and FuncCallerKeys. FuncCalls can help you look at downstream functions called by the current function, while FuncCallerKeys can look at upstream functions of the current function. This way, you can gradually build a broader network of function calls.

Through this step-by-step approach, you can effectively explore complex code structures, gradually expanding from local details to the overall architecture, and ultimately comprehensively understanding how the code works. This process is interactive and flexible; you can adjust the direction of your next exploration based on the discoveries at each step.

## Usage Example

You can look at the Appendix below, which has a detailed usage process.


## Main Algorithm

We outline the main steps of our algorithm:

1. Input Go file path and target function name.

2. Parse the file, extract the abstract syntax tree (AST) of the target function.

3. Convert the AST of the target function into our custom structure, which can describe any AST node type.

4. Starting from the function node, recursively check each node and its child nodes to see if they are related to the target variable.

    1. First, it creates a copy of the original node information, so operations can be performed without changing the original data.

    2. Then, it traverses all fields and child node lists of the node. For each field or child node, it recursively applies the same filtering process and saves the result in the new node information. If any child node is marked as relevant or should not be filtered, this information is passed to the current node.

    3. Next, it performs special processing based on the node type:

        - For identifiers or selector expressions (such as variable names or object properties), it checks if they match the target variable.

        - For return statements, break statements, and continue statements, if the user specifies to display these statements, they are marked as not to be filtered.

        - For code blocks or switch-case statements, it deletes all irrelevant child nodes that can be filtered.

        - For function declarations, it analyzes function call and caller relationships.

    4. Throughout the process, it marks which parts are relevant and which should not be filtered out.

    5. Finally, it returns the processed node information. This new node information contains all relevant parts, while irrelevant parts have been filtered out.

5. Regenerate the AST of the filtered function, then output it in code form.

## Discussion

### Motivation for Custom AST Node Structure

Initially, our tool used types and interfaces provided by the `go/ast` package, such as `ast.BlockStmt` and `ast.Expr`. As we developed more features, we found that developing a requirement needed to handle almost all types in `go/ast`, which was both inefficient and error-prone.

To address this issue, we designed a general structure called `NodeInfo` to represent `ast.Node`. This design was inspired by Python's reflection mechanism. `NodeInfo` uses a map to record the mapping from field names to field values of `ast.Node`.

This way, we can handle most types in `go/ast` with a general method, only needing to specially handle a few types, such as `ast.Ident`, `ast.SelectorExpr`, and `ast.BlockStmt`. This greatly reduced our development workload while making the code more concise and clear.

### The Auxiliary Role of AI in Development

In our development process, we used APIs from libraries such as `go/ast` and `reflect`. As developers responsible for business logic, we were initially unfamiliar with these APIs and didn't even know what functions they contained. Fortunately, we now have LLMs. With the help of AI, we can start development work directly without understanding the APIs.

The code of this tool contains a large number of AI-generated code snippets. Usually, we would have AI generate code at the function level. We would specify the function's signature and description, then let AI implement the function. We would fix any errors in it, then piece together these AI-generated functions to build the complete program.

We also noticed some characteristics of AI-generated code:

1. For simple functions, AI can usually generate code without errors.

2. When handling complex requests, AI often doesn't provide a code solution directly, but instead describes the complexity of the problem and various factors to consider, or provides an incomplete code snippet with ellipses.

3. For uncommon feature requests, the code generated by AI may contain errors.

4. We found that actively providing a code framework and leaving appropriate blank parts for AI to complete can make AI's code generation more accurate and stable.

## Appendix: A Usage Process Example

### Source Code

Suppose there's an example.go file in the current directory with the following content:

```go
// Package main provides tools for basic stock price analysis.
package main

import "fmt"

// Stock represents a company's stock.
type Stock struct {
    symbol string
    prices []float64
}

// NewStock creates a new Stock with the given symbol and prices.
func NewStock(symbol string, prices []float64) *Stock {
    return &Stock{symbol: symbol, prices: prices}
}

// CalculateAverage computes the average price of the stock.
func (s *Stock) CalculateAverage() float64 {
    sum := 0.0
    for _, price := range s.prices {
        sum += price
    }
    return sum / float64(len(s.prices))
}

// FindPeaks identifies price peaks in the stock data.
func (s *Stock) FindPeaks() []float64 {
    var peaks []float64
    for i := 1; i < len(s.prices)-1; i++ {
        if s.prices[i] > s.prices[i-1] && s.prices[i] > s.prices[i+1] {
            peaks = append(peaks, s.prices[i])
        }
    }
    return peaks
}

// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {
    stock := NewStock(symbol, prices)
    avg := stock.CalculateAverage()
    peaks := stock.FindPeaks()

    fmt.Printf("Analysis for %s:\n", symbol)
    fmt.Printf("Average price: $%.2f\n", avg)

    if len(peaks) == 0 {
        fmt.Println("No price peaks found.")
        return
    }

    fmt.Println("Price peaks:")
    for i, peak := range peaks {
        if i >= 3 {
            fmt.Println("... and more")
            break
        }
        fmt.Printf("  $%.2f\n", peak)
        continue
    }
}

func main() {
    prices := []float64{10.0, 11.5, 12.5, 11.0, 13.0, 12.0, 14.0}
    AnalyzeStock("EXMP", prices)
}
```

### Step 1

First, let's look at what the main function looks like overall.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "funcs": [
        {
            "source": "./example.go",
            "func_name": "main",
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": true
        }
    ]
}
```

#### output 1, the simplified go file

```go
//"key": "./example.go:|main",
//file://./example.go
func main() {
	prices := []float64{10.0, 11.5, 12.5, 11.0, 13.0, 12.0, 14.0}
	AnalyzeStock("EXMP", prices)
}

```

#### output 2, the updated input

```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "",
        "source": "./example.go",
        "recv_types": "",
        "func_name": "main",
        "comments": null,
        "var_names": null,
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": null,
        "caller_tree": null,
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": true
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": true
        }
    ]
}
```

### step 2

Explore the AnalyzeStock function called by the main function. We no longer need the show_all option. For the main function, we're only interested in the AnalyzeStock function.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:|AnalyzeStock",
        "source": "example.go",
        "recv_types": "",
        "func_name": "AnalyzeStock",
        "comments": null,
        "var_names": null,
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "./example.go:|main": {}
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {}
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

#### output 1, the simplified go file
```go
//"key": "./example.go:|main",
//file://./example.go
func main() {

	AnalyzeStock("EXMP", prices)
}

//"key": "example.go:|AnalyzeStock",
//file://example.go
// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {

	if len(peaks) == 0 {

		return
	}

	for i, peak := range peaks {
		if i >= 3 {

			break
		}

		continue
	}
}

```

#### output 2, the updated input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "./example.go:|main",
        "source": "./example.go",
        "recv_types": "",
        "func_name": "main",
        "comments": null,
        "var_names": [
            "AnalyzeStock"
        ],
        "func_calls": [
            "|.AnalyzeStock"
        ],
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {
            "example.go:|AnalyzeStock": {}
        },
        "caller_tree": {},
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {}
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

### step 3

Examine how the input parameters 'symbol' and 'prices' are used in the AnalyzeStock function. We also notice that the 'peaks' variable affects the function's control flow, so let's explore it as well.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "./example.go:|main",
        "source": "./example.go",
        "recv_types": "",
        "func_name": "main",
        "comments": null,
        "var_names": [
            "AnalyzeStock"
        ],
        "func_calls": [
            "|.AnalyzeStock"
        ],
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {
            "example.go:|AnalyzeStock": {}
        },
        "caller_tree": {},
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {}
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

#### output 1, the simplified go file
```go
//"key": "./example.go:|main",
//file://./example.go
func main() {

	AnalyzeStock("EXMP", prices)
}

//"key": "example.go:|AnalyzeStock",
//file://example.go
// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {
	stock := NewStock(symbol, prices)

	peaks := stock.FindPeaks()

	fmt.Printf("Analysis for %s:\n", symbol)

	if len(peaks) == 0 {

		return
	}

	for i, peak := range peaks {
		if i >= 3 {

			break
		}

		continue
	}
}

```

#### output 2, the updated input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "./example.go:|main",
        "source": "./example.go",
        "recv_types": "",
        "func_name": "main",
        "comments": null,
        "var_names": [
            "AnalyzeStock"
        ],
        "func_calls": [
            "|.AnalyzeStock"
        ],
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {
            "example.go:|AnalyzeStock": {}
        },
        "caller_tree": {},
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {}
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

### step 4

Investigate the 'stock' variable and the NewStock function.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:|AnalyzeStock",
        "source": "example.go",
        "recv_types": "",
        "func_name": "AnalyzeStock",
        "comments": null,
        "var_names": [
            "symbol",
            "prices",
            "peaks"
        ],
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "./example.go:|main": {}
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {}
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock"
            ],
            "func_calls": [
                "|.NewStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

#### output 1, the simplified go file
```go
//"key": "./example.go:|main",
//file://./example.go
func main() {

	AnalyzeStock("EXMP", prices)
}

//"key": "example.go:|AnalyzeStock",
//file://example.go
// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {
	stock := NewStock(symbol, prices)
	avg := stock.CalculateAverage()
	peaks := stock.FindPeaks()

	fmt.Printf("Analysis for %s:\n", symbol)

	if len(peaks) == 0 {

		return
	}

	for i, peak := range peaks {
		if i >= 3 {

			break
		}

		continue
	}
}

//"key": "example.go:|NewStock",
//file://example.go
// NewStock creates a new Stock with the given symbol and prices.
func NewStock(symbol string, prices []float64) *Stock {
	return &Stock{symbol: symbol, prices: prices}
}

```

#### output 2, the updated input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:|AnalyzeStock",
        "source": "example.go",
        "recv_types": "",
        "func_name": "AnalyzeStock",
        "comments": null,
        "var_names": [
            "symbol",
            "prices",
            "peaks",
            "stock"
        ],
        "func_calls": [
            "|.NewStock"
        ],
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "./example.go:|main": {}
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "example.go:|NewStock": {}
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock"
            ],
            "func_calls": [
                "|.NewStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|NewStock": {}
            },
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

### step 5

Within the AnalyzeStock function, examine the CalculateAverage and FindPeaks methods. Also, investigate the 'avg' and 'peak' variables.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:|AnalyzeStock",
        "source": "example.go",
        "recv_types": "",
        "func_name": "AnalyzeStock",
        "comments": null,
        "var_names": [
            "symbol",
            "prices",
            "peaks",
            "stock"
        ],
        "func_calls": [
            "|.NewStock"
        ],
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "./example.go:|main": {}
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "example.go:|NewStock": {}
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock",
                "avg",
                "peak"
            ],
            "func_calls": [
                "|.NewStock",
                "*Stock|.CalculateAverage",
                "*Stock|.FindPeaks"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|NewStock": {}
            },
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

#### output 1, the simplified go file
```go
//"key": "./example.go:|main",
//file://./example.go
func main() {

	AnalyzeStock("EXMP", prices)
}

//"key": "example.go:|AnalyzeStock",
//file://example.go
// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {
	stock := NewStock(symbol, prices)
	avg := stock.CalculateAverage()
	peaks := stock.FindPeaks()

	fmt.Printf("Analysis for %s:\n", symbol)
	fmt.Printf("Average price: $%.2f\n", avg)

	if len(peaks) == 0 {

		return
	}

	for i, peak := range peaks {
		if i >= 3 {

			break
		}
		fmt.Printf("  $%.2f\n", peak)
		continue
	}
}

//"key": "example.go:|NewStock",
//file://example.go
// NewStock creates a new Stock with the given symbol and prices.
func NewStock(symbol string, prices []float64) *Stock {
	return &Stock{symbol: symbol, prices: prices}
}

//"key": "example.go:*Stock|CalculateAverage",
//file://example.go
// CalculateAverage computes the average price of the stock.
func (s *Stock) CalculateAverage() float64 {

	return sum / float64(len(s.prices))
}

//"key": "example.go:*Stock|FindPeaks",
//file://example.go
// FindPeaks identifies price peaks in the stock data.
func (s *Stock) FindPeaks() []float64 {

	return peaks
}

```

#### output 2, the updated input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:|NewStock",
        "source": "example.go",
        "recv_types": "",
        "func_name": "NewStock",
        "comments": null,
        "var_names": null,
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "example.go:|AnalyzeStock": {
                "./example.go:|main": {}
            }
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "example.go:*Stock|CalculateAverage": {},
                    "example.go:*Stock|FindPeaks": {},
                    "example.go:|NewStock": {}
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock",
                "avg",
                "peak"
            ],
            "func_calls": [
                "|.NewStock",
                "*Stock|.CalculateAverage",
                "*Stock|.FindPeaks"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:*Stock|CalculateAverage": {},
                "example.go:*Stock|FindPeaks": {},
                "example.go:|NewStock": {}
            },
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|CalculateAverage",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "CalculateAverage",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|FindPeaks",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "FindPeaks",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

### step 6

Examine the 'sum' variable in CalculateAverage and the 'peaks' variable in FindPeaks.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:|NewStock",
        "source": "example.go",
        "recv_types": "",
        "func_name": "NewStock",
        "comments": null,
        "var_names": null,
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "example.go:|AnalyzeStock": {
                "./example.go:|main": {}
            }
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "example.go:*Stock|CalculateAverage": {},
                    "example.go:*Stock|FindPeaks": {},
                    "example.go:|NewStock": {}
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock",
                "avg",
                "peak"
            ],
            "func_calls": [
                "|.NewStock",
                "*Stock|.CalculateAverage",
                "*Stock|.FindPeaks"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:*Stock|CalculateAverage": {},
                "example.go:*Stock|FindPeaks": {},
                "example.go:|NewStock": {}
            },
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|CalculateAverage",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "CalculateAverage",
            "comments": null,
            "var_names": [
                "sum"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|FindPeaks",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "FindPeaks",
            "comments": null,
            "var_names": [
                "peaks"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

#### output 1, the simplified go file
```go
//"key": "./example.go:|main",
//file://./example.go
func main() {

	AnalyzeStock("EXMP", prices)
}

//"key": "example.go:|AnalyzeStock",
//file://example.go
// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {
	stock := NewStock(symbol, prices)
	avg := stock.CalculateAverage()
	peaks := stock.FindPeaks()

	fmt.Printf("Analysis for %s:\n", symbol)
	fmt.Printf("Average price: $%.2f\n", avg)

	if len(peaks) == 0 {

		return
	}

	for i, peak := range peaks {
		if i >= 3 {

			break
		}
		fmt.Printf("  $%.2f\n", peak)
		continue
	}
}

//"key": "example.go:|NewStock",
//file://example.go
// NewStock creates a new Stock with the given symbol and prices.
func NewStock(symbol string, prices []float64) *Stock {
	return &Stock{symbol: symbol, prices: prices}
}

//"key": "example.go:*Stock|CalculateAverage",
//file://example.go
// CalculateAverage computes the average price of the stock.
func (s *Stock) CalculateAverage() float64 {
	sum := 0.0
	for _, price := range s.prices {
		sum += price
	}
	return sum / float64(len(s.prices))
}

//"key": "example.go:*Stock|FindPeaks",
//file://example.go
// FindPeaks identifies price peaks in the stock data.
func (s *Stock) FindPeaks() []float64 {
	var peaks []float64
	for i := 1; i < len(s.prices)-1; i++ {
		if s.prices[i] > s.prices[i-1] && s.prices[i] > s.prices[i+1] {
			peaks = append(peaks, s.prices[i])
		}
	}
	return peaks
}

```

#### output 2, the updated input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:*Stock|FindPeaks",
        "source": "example.go",
        "recv_types": "*Stock",
        "func_name": "FindPeaks",
        "comments": null,
        "var_names": [
            "peaks"
        ],
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "example.go:|AnalyzeStock": {
                "./example.go:|main": {}
            }
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "example.go:*Stock|CalculateAverage": {},
                    "example.go:*Stock|FindPeaks": {},
                    "example.go:|NewStock": {}
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": null,
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock",
                "avg",
                "peak"
            ],
            "func_calls": [
                "|.NewStock",
                "*Stock|.CalculateAverage",
                "*Stock|.FindPeaks"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:*Stock|CalculateAverage": {},
                "example.go:*Stock|FindPeaks": {},
                "example.go:|NewStock": {}
            },
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": null,
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|CalculateAverage",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "CalculateAverage",
            "comments": null,
            "var_names": [
                "sum"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|FindPeaks",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "FindPeaks",
            "comments": null,
            "var_names": [
                "peaks"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

### step 7

Now that we have a clear understanding of the entire program, let's add comments to each function. We'll set collect_comments to true for all functions. This will allow us to see the call relationships between functions in the callee_tree and caller_tree. It will also display the comments for each corresponding function.

#### input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:*Stock|FindPeaks",
        "source": "example.go",
        "recv_types": "*Stock",
        "func_name": "FindPeaks",
        "comments": null,
        "var_names": [
            "peaks"
        ],
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "example.go:|AnalyzeStock": {
                "./example.go:|main": {}
            }
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "example.go:*Stock|CalculateAverage": {},
                    "example.go:*Stock|FindPeaks": {},
                    "example.go:|NewStock": {}
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": [
                "calculate the avg and the peaks of the stock.",
                "print them."
            ],
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock",
                "avg",
                "peak"
            ],
            "func_calls": [
                "|.NewStock",
                "*Stock|.CalculateAverage",
                "*Stock|.FindPeaks"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:*Stock|CalculateAverage": {},
                "example.go:*Stock|FindPeaks": {},
                "example.go:|NewStock": {}
            },
            "caller_tree": {
                "./example.go:|main": {}
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": [
                "return a *Stock."
            ],
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|CalculateAverage",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "CalculateAverage",
            "comments": [
                "computes the average price of the stock."
            ],
            "var_names": [
                "sum"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|FindPeaks",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "FindPeaks",
            "comments": [
                "identifies price peaks in the stock data."
            ],
            "var_names": [
                "peaks"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {},
            "caller_tree": {
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {}
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

#### output 1, the simplified go file
```go
//"key": "./example.go:|main",
//file://./example.go
func main() {

	AnalyzeStock("EXMP", prices)
}

//"key": "example.go:|AnalyzeStock",
//file://example.go
// AnalyzeStock performs a comprehensive analysis of the stock.
func AnalyzeStock(symbol string, prices []float64) {
	stock := NewStock(symbol, prices)
	avg := stock.CalculateAverage()
	peaks := stock.FindPeaks()

	fmt.Printf("Analysis for %s:\n", symbol)
	fmt.Printf("Average price: $%.2f\n", avg)

	if len(peaks) == 0 {

		return
	}

	for i, peak := range peaks {
		if i >= 3 {

			break
		}
		fmt.Printf("  $%.2f\n", peak)
		continue
	}
}

//"key": "example.go:|NewStock",
//file://example.go
// NewStock creates a new Stock with the given symbol and prices.
func NewStock(symbol string, prices []float64) *Stock {
	return &Stock{symbol: symbol, prices: prices}
}

//"key": "example.go:*Stock|CalculateAverage",
//file://example.go
// CalculateAverage computes the average price of the stock.
func (s *Stock) CalculateAverage() float64 {
	sum := 0.0
	for _, price := range s.prices {
		sum += price
	}
	return sum / float64(len(s.prices))
}

//"key": "example.go:*Stock|FindPeaks",
//file://example.go
// FindPeaks identifies price peaks in the stock data.
func (s *Stock) FindPeaks() []float64 {
	var peaks []float64
	for i := 1; i < len(s.prices)-1; i++ {
		if s.prices[i] > s.prices[i-1] && s.prices[i] > s.prices[i+1] {
			peaks = append(peaks, s.prices[i])
		}
	}
	return peaks
}

```

#### output 2, the updated input
```json
{
    "method": "GetRelevantFuncs",
    "func_task": {
        "key": "example.go:*Stock|FindPeaks",
        "source": "example.go",
        "recv_types": "*Stock",
        "func_name": "FindPeaks",
        "comments": [
            "identifies price peaks in the stock data."
        ],
        "var_names": [
            "peaks"
        ],
        "func_calls": null,
        "func_caller_keys": null,
        "extra_imports": null,
        "callee_tree": {},
        "caller_tree": {
            "example.go:|AnalyzeStock": {
                "./example.go:|main": {}
            }
        },
        "show_return": true,
        "show_break": true,
        "show_continue": true,
        "exact_match": false,
        "subsequence_match": false,
        "enable_call": false,
        "faraway_match": false,
        "only_relevant_func": false,
        "collect_comments": true,
        "show_all": false
    },
    "funcs": [
        {
            "key": "./example.go:|main",
            "source": "./example.go",
            "recv_types": "",
            "func_name": "main",
            "comments": null,
            "var_names": [
                "AnalyzeStock"
            ],
            "func_calls": [
                "|.AnalyzeStock"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "example.go:|AnalyzeStock": {
                    "comments": [
                        "calculate the avg and the peaks of the stock.",
                        "print them."
                    ],
                    "example.go:*Stock|CalculateAverage": {
                        "comments": [
                            "computes the average price of the stock."
                        ]
                    },
                    "example.go:*Stock|FindPeaks": {
                        "comments": [
                            "identifies price peaks in the stock data."
                        ]
                    },
                    "example.go:|NewStock": {
                        "comments": [
                            "return a *Stock."
                        ]
                    }
                }
            },
            "caller_tree": {},
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|AnalyzeStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "AnalyzeStock",
            "comments": [
                "calculate the avg and the peaks of the stock.",
                "print them."
            ],
            "var_names": [
                "symbol",
                "prices",
                "peaks",
                "stock",
                "avg",
                "peak"
            ],
            "func_calls": [
                "|.NewStock",
                "*Stock|.CalculateAverage",
                "*Stock|.FindPeaks"
            ],
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "comments": [
                    "calculate the avg and the peaks of the stock.",
                    "print them."
                ],
                "example.go:*Stock|CalculateAverage": {
                    "comments": [
                        "computes the average price of the stock."
                    ]
                },
                "example.go:*Stock|FindPeaks": {
                    "comments": [
                        "identifies price peaks in the stock data."
                    ]
                },
                "example.go:|NewStock": {
                    "comments": [
                        "return a *Stock."
                    ]
                }
            },
            "caller_tree": {
                "./example.go:|main": {},
                "comments": [
                    "calculate the avg and the peaks of the stock.",
                    "print them."
                ]
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:|NewStock",
            "source": "example.go",
            "recv_types": "",
            "func_name": "NewStock",
            "comments": [
                "return a *Stock."
            ],
            "var_names": null,
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "comments": [
                    "return a *Stock."
                ]
            },
            "caller_tree": {
                "comments": [
                    "return a *Stock."
                ],
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {},
                    "comments": [
                        "calculate the avg and the peaks of the stock.",
                        "print them."
                    ]
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|CalculateAverage",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "CalculateAverage",
            "comments": [
                "computes the average price of the stock."
            ],
            "var_names": [
                "sum"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "comments": [
                    "computes the average price of the stock."
                ]
            },
            "caller_tree": {
                "comments": [
                    "computes the average price of the stock."
                ],
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {},
                    "comments": [
                        "calculate the avg and the peaks of the stock.",
                        "print them."
                    ]
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        },
        {
            "key": "example.go:*Stock|FindPeaks",
            "source": "example.go",
            "recv_types": "*Stock",
            "func_name": "FindPeaks",
            "comments": [
                "identifies price peaks in the stock data."
            ],
            "var_names": [
                "peaks"
            ],
            "func_calls": null,
            "func_caller_keys": null,
            "extra_imports": null,
            "callee_tree": {
                "comments": [
                    "identifies price peaks in the stock data."
                ]
            },
            "caller_tree": {
                "comments": [
                    "identifies price peaks in the stock data."
                ],
                "example.go:|AnalyzeStock": {
                    "./example.go:|main": {},
                    "comments": [
                        "calculate the avg and the peaks of the stock.",
                        "print them."
                    ]
                }
            },
            "show_return": true,
            "show_break": true,
            "show_continue": true,
            "exact_match": false,
            "subsequence_match": false,
            "enable_call": false,
            "faraway_match": false,
            "only_relevant_func": false,
            "collect_comments": true,
            "show_all": false
        }
    ]
}
```

# License

This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.
